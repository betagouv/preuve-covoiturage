<div class="CampaignForm">
  <div class="CampaignForm--loading" *ngIf="loading">
    <mat-spinner></mat-spinner>
  </div>
  <mat-horizontal-stepper #stepper [linear]="true" *ngIf="!loading" [selectedIndex]="currentStep">
    <mat-step [completed]="matStepperCompleted">
      <ng-template matStepLabel>Campagne</ng-template>
      <app-page-content>
        <div class="CampaignForm-content">
          <div class="CampaignForm-content-wrapper">
            <app-campaign-templates
              (setTemplate)="setTemplate($event)"
              [matStepper]="stepper"
              [campaignForm]="campaignFormGroup"
            ></app-campaign-templates>
            <app-help-card
              [svgIcon]="helpCard.svgIcon"
              [title]="helpCard.title"
              [hint]="helpCard.hint"
              [link]="helpCard.link"
            >
            </app-help-card>
          </div>
        </div>
      </app-page-content>
    </mat-step>
    <mat-step [stepControl]="campaignFormGroup.get('rules')">
      <ng-template matStepLabel>Éligibilité</ng-template>
      <app-page-content>
        <div class="CampaignForm-content">
          <div class="CampaignForm-content-wrapper">
            <app-rules-form [campaignForm]="campaignFormGroup"></app-rules-form>
            <app-help-card
              [svgIcon]="helpCard.svgIcon"
              [title]="helpCard.title"
              [hint]="helpCard.hint"
              [link]="helpCard.link"
            >
            </app-help-card>
          </div>
          <div class="CampaignForm-content-actions">
            <button mat-flat-button class="large" matStepperPrevious>Étape précédente</button>
            <button
              mat-flat-button
              class="large"
              color="primary"
              matStepperNext
              [disabled]="!campaignFormGroup.get('rules').valid"
            >
              Étape suivante
            </button>
          </div>
        </div>
      </app-page-content>
    </mat-step>
    <mat-step [stepControl]="campaignFormGroup">
      <ng-template matStepLabel>Rétribution</ng-template>
      <app-page-content>
        <div class="CampaignForm-content">
          <div class="CampaignForm-content-wrapper">
            <app-parameters-form [campaignForm]="campaignFormGroup"></app-parameters-form>
            <app-help-card
              *ngIf="!campaignFormGroup.controls.expertMode.value"
              [svgIcon]="helpCard.svgIcon"
              [title]="helpCard.title"
              [hint]="helpCard.hint"
              [link]="helpCard.link"
            >
            </app-help-card>
            <app-formula-guide *ngIf="campaignFormGroup.controls.expertMode.value"></app-formula-guide>
          </div>
          <div class="CampaignForm-content-actions">
            <button mat-flat-button class="large" matStepperPrevious>Étape précédente</button>
            <button mat-flat-button class="large" color="primary" matStepperNext [disabled]="!campaignFormGroup.valid">
              Voir le récapitulatif
            </button>
          </div>
        </div>
      </app-page-content>
    </mat-step>
    <mat-step>
      <ng-template matStepLabel>Récapitulatif</ng-template>
      <app-page-content>
        <div class="CampaignForm-content">
          <div class="CampaignForm-content-wrapper CampaignForm-content-wrapper--summary">
            <app-summary-form
              [campaignForm]="campaignFormGroup"
              [loading]="requestLoading"
              (onSaveCampaign)="saveCampaign($event)"
            ></app-summary-form>
          </div>
          <div class="CampaignForm-content-actions">
            <button mat-flat-button class="large" matStepperPrevious>Étape précédente</button>
          </div>
        </div>
      </app-page-content>
    </mat-step>
  </mat-horizontal-stepper>
</div>
